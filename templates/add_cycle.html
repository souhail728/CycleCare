{% extends "base.html" %}

{% block title %}Ajouter un Cycle - CycleCare{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card card-3d">
            <div class="card-header bg-gradient-primary text-white text-center">
                <h3 class="mb-0">
                    <i class="fas fa-plus-circle me-2"></i>
                    Ajouter un Nouveau Cycle
                </h3>
            </div>
            <div class="card-body p-4">
                <form method="POST" id="cycleForm">
                    <div class="row">
                        <!-- Date de d√©but -->
                        <div class="col-md-6 mb-3">
                            <label for="start_date" class="form-label fw-bold">
                                <i class="fas fa-calendar-day text-primary me-2"></i>
                                Date de d√©but des r√®gles *
                            </label>
                            <input type="date" class="form-control form-control-3d" id="start_date" name="start_date" required>
                            <div class="form-text">Date du premier jour de vos r√®gles</div>
                        </div>

                        <!-- Date de fin -->
                        <div class="col-md-6 mb-3">
                            <label for="end_date" class="form-label fw-bold">
                                <i class="fas fa-calendar-check text-success me-2"></i>
                                Date de fin des r√®gles
                            </label>
                            <input type="date" class="form-control form-control-3d" id="end_date" name="end_date">
                            <div class="form-text">Date du dernier jour de vos r√®gles (optionnel)</div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Dur√©e du cycle -->
                        <div class="col-md-6 mb-3">
                            <label for="cycle_length" class="form-label fw-bold">
                                <i class="fas fa-clock text-info me-2"></i>
                                Dur√©e du cycle (jours)
                            </label>
                            <input type="number" class="form-control form-control-3d" id="cycle_length" name="cycle_length" 
                                   value="28" min="21" max="35">
                            <div class="form-text">Dur√©e habituelle de votre cycle (21-35 jours)</div>
                        </div>

                        <!-- Dur√©e des r√®gles -->
                        <div class="col-md-6 mb-3">
                            <label for="period_length" class="form-label fw-bold">
                                <i class="fas fa-tint text-danger me-2"></i>
                                Dur√©e des r√®gles (jours)
                            </label>
                            <input type="number" class="form-control form-control-3d" id="period_length" name="period_length" 
                                   value="5" min="1" max="10">
                            <div class="form-text">Dur√©e de vos r√®gles (1-10 jours)</div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Intensit√© du flux -->
                        <div class="col-md-6 mb-3">
                            <label for="flow_intensity" class="form-label fw-bold">
                                <i class="fas fa-thermometer-half text-warning me-2"></i>
                                Intensit√© du flux
                            </label>
                            <select class="form-select form-control-3d" id="flow_intensity" name="flow_intensity">
                                <option value="">S√©lectionner...</option>
                                <option value="L√©ger">L√©ger</option>
                                <option value="Mod√©r√©">Mod√©r√©</option>
                                <option value="Abondant">Abondant</option>
                                <option value="Tr√®s abondant">Tr√®s abondant</option>
                            </select>
                        </div>

                        <!-- Humeur -->
                        <div class="col-md-6 mb-3">
                            <label for="mood" class="form-label fw-bold">
                                <i class="fas fa-smile text-success me-2"></i>
                                Humeur g√©n√©rale
                            </label>
                            <select class="form-select form-control-3d" id="mood" name="mood">
                                <option value="">S√©lectionner...</option>
                                <option value="Excellente">üòä Excellente</option>
                                <option value="Bonne">üôÇ Bonne</option>
                                <option value="Neutre">üòê Neutre</option>
                                <option value="Irritable">üò§ Irritable</option>
                                <option value="Triste">üò¢ Triste</option>
                                <option value="Anxieuse">üò∞ Anxieuse</option>
                            </select>
                        </div>
                    </div>

                    <!-- Sympt√¥mes -->
                    <div class="mb-4">
                        <label for="symptoms" class="form-label fw-bold">
                            <i class="fas fa-notes-medical text-secondary me-2"></i>
                            Sympt√¥mes et notes
                        </label>
                        <textarea class="form-control form-control-3d" id="symptoms" name="symptoms" rows="4" 
                                  placeholder="D√©crivez vos sympt√¥mes, douleurs, ou toute autre observation..."></textarea>
                        <div class="form-text">
                            Exemples: crampes, maux de t√™te, sensibilit√© des seins, fatigue, etc.
                        </div>
                    </div>

                    <!-- Conseils -->
                    <div class="alert alert-info card-3d mb-4">
                        <h6 class="alert-heading">
                            <i class="fas fa-lightbulb me-2"></i>
                            Conseils pour un suivi pr√©cis
                        </h6>
                        <ul class="mb-0 small">
                            <li>Enregistrez le premier jour de vos r√®gles d√®s qu'elles commencent</li>
                            <li>Notez vos sympt√¥mes quotidiennement pour identifier des patterns</li>
                            <li>La dur√©e moyenne d'un cycle est de 28 jours, mais peut varier de 21 √† 35 jours</li>
                            <li>Consultez votre m√©decin si vous observez des changements importants</li>
                        </ul>
                    </div>

                    <!-- Boutons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-3d me-md-2">
                            <i class="fas fa-times me-2"></i>
                            Annuler
                        </a>
                        <button type="submit" class="btn btn-primary btn-3d">
                            <i class="fas fa-save me-2"></i>
                            Enregistrer le cycle
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Pr√©dictions -->
<div class="row justify-content-center mt-4">
    <div class="col-lg-8">
        <div class="card card-3d">
            <div class="card-header bg-gradient-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-crystal-ball me-2"></i>
                    Pr√©dictions bas√©es sur vos donn√©es
                </h5>
            </div>
            <div class="card-body">
                <div id="predictions" class="text-center text-muted">
                    <i class="fas fa-spinner fa-spin me-2"></i>
                    S√©lectionnez une date de d√©but pour voir les pr√©dictions...
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.getElementById('start_date');
    const endDateInput = document.getElementById('end_date');
    const cycleLengthInput = document.getElementById('cycle_length');
    const predictionsDiv = document.getElementById('predictions');

    // D√©finir la date d'aujourd'hui comme maximum pour la date de d√©but
    const today = new Date().toISOString().split('T')[0];
    startDateInput.max = today;
    endDateInput.max = today;

    function updatePredictions() {
        const startDate = startDateInput.value;
        const cycleLength = parseInt(cycleLengthInput.value) || 28;

        if (startDate) {
            const start = new Date(startDate);
            const ovulation = new Date(start);
            ovulation.setDate(start.getDate() + cycleLength - 14);
            
            const nextPeriod = new Date(start);
            nextPeriod.setDate(start.getDate() + cycleLength);

            const fertileStart = new Date(ovulation);
            fertileStart.setDate(ovulation.getDate() - 5);
            
            const fertileEnd = new Date(ovulation);
            fertileEnd.setDate(ovulation.getDate() + 1);

            predictionsDiv.innerHTML = `
                <div class="row text-center">
                    <div class="col-md-4 mb-3">
                        <div class="prediction-item">
                            <i class="fas fa-egg text-warning fa-2x mb-2"></i>
                            <h6 class="fw-bold">Ovulation pr√©vue</h6>
                            <p class="text-warning mb-0">${ovulation.toLocaleDateString('fr-FR')}</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="prediction-item">
                            <i class="fas fa-heart text-pink fa-2x mb-2"></i>
                            <h6 class="fw-bold">Fen√™tre fertile</h6>
                            <p class="text-pink mb-0">${fertileStart.toLocaleDateString('fr-FR')} - ${fertileEnd.toLocaleDateString('fr-FR')}</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="prediction-item">
                            <i class="fas fa-calendar-check text-primary fa-2x mb-2"></i>
                            <h6 class="fw-bold">Prochaines r√®gles</h6>
                            <p class="text-primary mb-0">${nextPeriod.toLocaleDateString('fr-FR')}</p>
                        </div>
                    </div>
                </div>
            `;
        } else {
            predictionsDiv.innerHTML = `
                <i class="fas fa-info-circle me-2"></i>
                S√©lectionnez une date de d√©but pour voir les pr√©dictions...
            `;
        }
    }

    // Mettre √† jour les pr√©dictions quand les valeurs changent
    startDateInput.addEventListener('change', updatePredictions);
    cycleLengthInput.addEventListener('input', updatePredictions);

    // Validation du formulaire
    document.getElementById('cycleForm').addEventListener('submit', function(e) {
        const startDate = new Date(startDateInput.value);
        const endDate = endDateInput.value ? new Date(endDateInput.value) : null;

        if (endDate && endDate < startDate) {
            e.preventDefault();
            alert('La date de fin ne peut pas √™tre ant√©rieure √† la date de d√©but.');
            return false;
        }

        if (endDate && (endDate - startDate) / (1000 * 60 * 60 * 24) > 10) {
            e.preventDefault();
            alert('La dur√©e des r√®gles ne peut pas d√©passer 10 jours.');
            return false;
        }
    });

    // Auto-compl√©tion de la date de fin
    endDateInput.addEventListener('change', function() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(this.value);
        
        if (startDate && endDate) {
            const periodLength = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            document.getElementById('period_length').value = periodLength;
        }
    });
});
</script>
{% endblock %}
